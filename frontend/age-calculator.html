<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Age Calculator</title>
    <style>
        :root {
            --primary: #2196F3;
            --bg: #ffffff;
            --text: #333333;
        }

        .dark-theme {
            --primary: #673AB7;
            --bg: #2d2d2d;
            --text: #ffffff;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: all 0.3s ease;
            margin: 0;
            padding: 20px;
        }

        .calculator {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .theme-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .input-group {
            margin: 20px 0;
        }

        input[type="date"] {
            padding: 8px;
            margin: 0 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .life-progress {
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.5s ease;
        }

        .historical-events {
            font-size: 0.9em;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
        }

        #result > div {
            margin: 15px 0;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <button class="theme-switcher" onclick="toggleTheme()">ðŸŒ“ Toggle Theme</button>
    
    <div class="calculator">
        <h1>Ultimate Age Calculator</h1>
        <div class="input-group">
            <label for="birthdate">Birth Date:</label>
            <input type="date" id="birthdate" max="">
            <button onclick="calculateAge()">Calculate</button>
        </div>

        <div class="life-progress">
            <div class="progress-fill" style="width: 0%"></div>
        </div>

        <div id="result">
            <div id="age-breakdown"></div>
            <div id="zodiac-sign"></div>
            <div id="next-birthday"></div>
            <div id="leap-year-info"></div>
            <div id="generation-info"></div>
            <div id="historical-events" class="historical-events"></div>
            <div id="milliseconds-counter"></div>
        </div>

        <button onclick="saveCalculation()">Save Result</button>
        <button onclick="shareResults()">Share</button>
    </div>

    <script>
        // Initialize max date to today
        document.getElementById('birthdate').max = new Date().toISOString().split('T')[0];
        let currentAge = {}; // Store current calculation for sharing

        const HISTORICAL_EVENTS = {
            2000: ["Y2K bug concerns", "PlayStation 2 released"],
            1995: ["Windows 95 launched", "DVD format invented"],
            1980: ["CNN launched", "Pac-Man arcade game released"],
            1975: ["Microsoft founded", "Jaws movie premiered"],
            1969: ["Moon landing", "ARPANET (early Internet) created"]
        };

        const GENERATIONS = [
            { name: "Gen Alpha", start: 2013 }, 
            { name: "Gen Z", start: 1997 },
            { name: "Millennial", start: 1981 },
            { name: "Gen X", start: 1965 },
            { name: "Baby Boomer", start: 1946 }
        ];

        function calculateAge() {
            const birthdate = new Date(document.getElementById('birthdate').value);
            const today = new Date();

            if (isNaN(birthdate) || birthdate > today) {
                alert("Please enter a valid date in the past");
                return;
            }

            // Age calculations
            let years = today.getFullYear() - birthdate.getFullYear();
            let months = today.getMonth() - birthdate.getMonth();
            let days = today.getDate() - birthdate.getDate();

            if (days < 0) {
                months--;
                days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }

            // Store values for sharing
            currentAge = {
                years,
                zodiac: getZodiacSign(birthdate),
                generation: getGeneration(birthdate.getFullYear())
            };

            // Detailed breakdown
            const timeDiff = today - birthdate;
            const weeks = Math.floor(timeDiff / (1000 * 60 * 60 * 24 * 7));
            const hours = Math.floor(timeDiff / (1000 * 60 * 60));

            // Life progress (WHO average lifespan: 73 years)
            const lifePercentage = Math.min((years / 73) * 100, 100);
            document.querySelector('.progress-fill').style.width = `${lifePercentage}%`;

            // Update display
            document.getElementById('age-breakdown').innerHTML = `
                <h3>${years} Years ${months} Months ${days} Days</h3>
                <p>${weeks} weeks | ${hours} hours</p>
            `;
            
            document.getElementById('zodiac-sign').textContent = `Zodiac Sign: ${currentAge.zodiac}`;
            document.getElementById('generation-info').textContent = `Generation: ${currentAge.generation}`;
            
            // Next birthday
            const nextBday = getNextBirthday(birthdate);
            const daysUntilBday = Math.ceil((nextBday - today) / (1000 * 60 * 60 * 24));
            document.getElementById('next-birthday').textContent = daysUntilBday > 0 
                ? `Next birthday in ${daysUntilBday} days`
                : "ðŸŽ‰ Happy Birthday!";

            // Leap year
            const isLeapYear = (year) => (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
            document.getElementById('leap-year-info').textContent = 
                `Born in ${isLeapYear(birthdate.getFullYear()) ? 'a leap year' : 'not a leap year'}`;

            // Historical events
            const birthYear = birthdate.getFullYear();
            document.getElementById('historical-events').innerHTML = HISTORICAL_EVENTS[birthYear] 
                ? `<strong>${birthYear} Events:</strong><br>â€¢ ${HISTORICAL_EVENTS[birthYear].join('<br>â€¢ ')}`
                : "No notable events found for this year";

            // Milliseconds counter
            const birthDateTime = birthdate.getTime();
            updateMillisecondsCounter(birthDateTime);
        }

        function updateMillisecondsCounter(birthDateTime) {
            const counterElement = document.getElementById('milliseconds-counter');
            let interval = setInterval(() => {
                if (!document.getElementById('birthdate').value) {
                    clearInterval(interval);
                    return;
                }
                const msLived = Date.now() - birthDateTime;
                counterElement.textContent = `Milliseconds lived: ${msLived.toLocaleString()}`;
            }, 100);
        }

        function getZodiacSign(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const zodiacs = [
                ["Capricorn", 19], ["Aquarius", 18], ["Pisces", 20], ["Aries", 19],
                ["Taurus", 20], ["Gemini", 20], ["Cancer", 22], ["Leo", 22],
                ["Virgo", 22], ["Libra", 22], ["Scorpio", 21], ["Sagittarius", 21]
            ];
            return day > zodiacs[month % 12][1] ? zodiacs[month % 12][0] : zodiacs[(month - 1) % 12][0];
        }

        function getNextBirthday(birthdate) {
            const today = new Date();
            const next = new Date(today.getFullYear(), birthdate.getMonth(), birthdate.getDate());
            if (next < today) next.setFullYear(today.getFullYear() + 1);
            return next;
        }

        function getGeneration(birthYear) {
            const generation = GENERATIONS.find(g => birthYear >= g.start);
            return generation ? generation.name : "Baby Boomer or earlier";
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
        }

        function saveCalculation() {
            const birthdate = document.getElementById('birthdate').value;
            if (birthdate) {
                localStorage.setItem('lastBirthdate', birthdate);
                alert('Calculation saved!');
            }
        }

        async function shareResults() {
            try {
                await navigator.share({
                    title: 'Age Calculation',
                    text: `Age: ${currentAge.years} years\nZodiac: ${currentAge.zodiac}\nGeneration: ${currentAge.generation}`,
                    url: window.location.href
                });
            } catch (err) {
                navigator.clipboard.writeText(
                    `Age: ${currentAge.years} years\nZodiac: ${currentAge.zodiac}\nGeneration: ${currentAge.generation}`
                );
                alert('Results copied to clipboard!');
            }
        }

        // Load previous calculation
        window.onload = () => {
            const last = localStorage.getItem('lastBirthdate');
            if (last) {
                document.getElementById('birthdate').value = last;
                calculateAge();
            }
        }
    </script>
</body>
</html>